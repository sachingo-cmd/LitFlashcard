<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Author Flashcards & Quiz</title>
  <style>
    /* Color palette from request */
    :root {
      --color-terracotta: #b8483c; /* (184,72,60) */
      --color-goldenrod: #b8a245; /* (184,162,69) */
      --color-charcoal: #3c393e; /* (60,57,62) */
      --color-sage: #a6bd9e; /* (166,189,158) */
      --color-taupe: #9c705d; /* (156,112,93) */

      --bg-light: #f7f8f6;
      --text-dark: var(--color-charcoal);
      --text-light: #fff;

      --btn-bg: var(--color-terracotta);
      --btn-hover-bg: #91342e;
      --btn-text: var(--text-light);

      --header-bg: var(--color-charcoal);
      --header-text: var(--text-light);

      --card-bg: #fff;
      --card-shadow: rgba(60, 57, 62, 0.15);
    }

    /* Reset and base */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
      margin: 0;
      padding: 0;
      color: var(--text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }

    header {
      background-color: var(--header-bg);
      color: var(--header-text);
      width: 100%;
      padding: 16px 24px;
      box-sizing: border-box;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    header h2 {
      margin: 0;
      font-weight: 700;
      font-size: 1.4rem;
      user-select: none;
    }
    header nav a {
      color: var(--btn-text);
      font-weight: 600;
      text-decoration: none;
      border: 2px solid var(--btn-text);
      padding: 6px 14px;
      border-radius: 8px;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    header nav a:hover,
    header nav a:focus {
      background-color: var(--btn-text);
      color: var(--header-bg);
      outline: none;
    }

    /* Container for flashcards and quiz */
    main {
      max-width: 1100px;
      width: 90vw;
      margin: 20px auto 40px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      align-items: flex-start;
    }

    /* Flashcards container */
    .container {
      flex: 1 1 520px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
      max-height: 80vh;
      overflow-y: auto;
      background: var(--card-bg);
      box-shadow: 0 4px 16px var(--card-shadow);
      border-radius: 14px;
      padding: 16px;
    }

    /* Each flashcard */
    .flip-card {
      background: transparent;
      width: 175px;
      cursor: pointer;
      border-radius: 12px;
      transition: all 0.3s ease;
      box-sizing: border-box;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      user-select: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .flip-card-inner {
      position: relative;
      width: 100%;
      min-height: 224px;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      border-radius: 12px;
      box-shadow: 2px 2px 12px rgba(60,57,62,0.15);
      border: 1px solid #ccc;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      background: var(--card-bg);
      overflow: visible;
    }
    .flip-card.flipped .flip-card-inner {
      transform: rotateY(180deg);
    }
    .flip-card.expanded {
      min-height: 294px;
      box-shadow: 0 8px 16px rgba(60,57,62,0.25);
    }
    .flip-card.expanded .flip-card-inner {
      min-height: 294px;
    }
    .flip-card-front, .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 12px;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      padding: 0;
      user-select: none;
    }
    .flip-card-front {
      background: var(--card-bg);
      justify-content: center;
      z-index: 2;
      overflow-y: auto;
    }
    .flip-card-front img {
      max-width: calc(100% - 2px);
      max-height: calc(100% - 2px);
      padding: 1px;
      box-sizing: border-box;
      object-fit: contain;
      border-radius: 12px;
      margin: auto;
      user-select: none;
      display: block;
    }
    .flip-card-back {
      background: var(--color-sage);
      transform: rotateY(180deg);
      text-align: left;
      padding: 20px 24px;
      overflow-y: auto;
      color: var(--color-charcoal);
      justify-content: flex-start;
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    .flip-card-back strong {
      display: block;
      font-size: 20px;
      margin-bottom: 12px;
      user-select: none;
      font-weight: 700;
    }
    .works-list {
      padding-left: 18px;
      margin: 0;
      font-size: 16px;
      line-height: 1.4;
      max-height: 180px;
      overflow-y: auto;
      color: var(--color-charcoal);
    }
    .works-list li {
      margin-bottom: 4px;
    }

    /* Quiz Container */
    aside.quiz-container {
      max-width: 450px;
      width: 100%;
      background: var(--card-bg);
      border-radius: 14px;
      box-shadow: 0 4px 16px var(--card-shadow);
      padding: 20px 28px;
      display: flex;
      flex-direction: column;
      user-select: none;
    }
    aside.quiz-container h3 {
      margin: 0 0 16px 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-terracotta);
      text-align: center;
      user-select: text;
    }
    .quiz-work-title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 20px;
      min-height: 60px;
      text-align: center;
      color: var(--color-charcoal);
      user-select: text;
    }
    input[type="text"].quiz-input {
      font-size: 18px;
      padding: 10px 12px;
      border-radius: 8px;
      border: 2px solid var(--color-taupe);
      margin-bottom: 12px;
      width: 100%;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }
    input[type="text"].quiz-input:focus {
      outline: none;
      border-color: var(--color-terracotta);
      background: #fffdeb;
    }
    button.quiz-btn {
      background: var(--btn-bg);
      border: none;
      color: var(--btn-text);
      padding: 12px 0;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      user-select: none;
      margin-bottom: 12px;
      transition: background-color 0.3s ease;
    }
    button.quiz-btn:hover:not(:disabled) {
      background: var(--btn-hover-bg);
    }
    button.quiz-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .quiz-feedback {
      text-align: center;
      font-weight: 700;
      min-height: 36px;
      margin-bottom: 12px;
      font-size: 1rem;
    }
    .quiz-feedback.correct {
      color: var(--color-terracotta);
    }
    .quiz-feedback.wrong {
      color: var(--color-taupe);
    }
    .quiz-hint {
      font-style: italic;
      color: var(--color-taupe);
      text-align: center;
      min-height: 28px;
      margin-bottom: 12px;
      user-select: text;
    }
    .quiz-progress {
      font-size: 0.9rem;
      text-align: center;
      margin-bottom: 12px;
      color: var(--color-charcoal);
      user-select: none;
    }

    /* Controls */
    .controls {
      width: 100%;
      max-width: 1100px;
      padding: 0 20px;
      margin-bottom: 12px;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    .controls button {
      background-color: var(--color-goldenrod);
      border: none;
      color: var(--color-charcoal);
      font-weight: 700;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      box-shadow: 1px 2px 4px rgba(156,112,93,0.7);
      font-size: 1rem;
    }
    .controls button:hover {
      background-color: var(--color-taupe);
      color: var(--color-light, #fff);
    }

    /* Responsive adjustments */
    @media (max-width: 1000px) {
      main {
        flex-direction: column;
        align-items: center;
      }
      .container, aside.quiz-container {
        max-width: 100%;
        width: 90vw;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js" defer></script>
</head>
<body>
  <header>
    <h2>Author Flashcards & Quiz</h2>
    <nav>
      <a href="https://sachingo-cmd.github.io/UGC-NET-English-Literature-Flash-Info/" target="_blank" rel="noopener noreferrer" aria-label="Open UGC-NET English Literature Flash Info in new tab">UGC-NET English Lit Flash Info</a>
    </nav>
  </header>

  <div class="controls" role="region" aria-label="Global controls">
    <button type="button" onclick="resetCards()">Reset Cards</button>
    <button type="button" onclick="loadFullData()">Reload All Data</button>
    <button type="button" onclick="startQuiz()">Start Quiz Mode</button>
    <button type="button" onclick="exitQuiz()" id="exitQuizBtn" style="display:none;">Exit Quiz Mode</button>
  </div>

  <main>
    <section class="container" id="cardContainer" aria-live="polite" aria-label="Author Flashcards"></section>

    <aside class="quiz-container" id="quizContainer" hidden aria-live="assertive" aria-label="Author Work Quiz">
      <h3>Quiz Mode: Identify the Author</h3>
      <div class="quiz-work-title" id="quizWorkTitle" aria-live="polite"></div>
      <input type="text" id="quizAnswerInput" class="quiz-input" placeholder="Type author name here" aria-label="Type author name here" autocomplete="off" />
      <button class="quiz-btn" id="quizSubmitBtn" type="button">Submit Answer</button>
      <div class="quiz-feedback" id="quizFeedback" role="alert"></div>
      <div class="quiz-hint" id="quizHint"></div>
      <div class="quiz-progress" id="quizProgress"></div>
      <button class="quiz-btn" id="quizNextBtn" type="button" disabled>Next Work</button>
    </aside>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js" 
          integrity="sha512-CRZ46qY7I+LCCRuNHLhFbXzV6OicHKWqSxlwSpR8hyQGO4gAfGFiDVqB/taxoXyNWO7cRTiqLaqocRgBoN68mw==" 
          crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>

  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT7cWnraaDNjm3MW4tUeVrVftj6iEBYwNkGZ7WsJsQfte3rbRhr1AF43fbIyVe1-ZMtvRVZgDrwusrT/pub?output=csv';
    const STORAGE_KEY = 'authorFlashcardsCache';

    // Flashcard Data
    let allCardsData = [];
    let currentMode = 'author-front'; // keeps your original mode (unused now)
    const cardContainer = document.getElementById('cardContainer');

    // Quiz Mode Data & Elements
    let quizData = [];
    let quizIndex = 0;
    let quizAttempts = 0;
    const maxHints = 3;
    let fuse;
    let quizActive = false;

    const quizContainer = document.getElementById('quizContainer');
    const quizWorkTitle = document.getElementById('quizWorkTitle');
    const quizAnswerInput = document.getElementById('quizAnswerInput');
    const quizSubmitBtn = document.getElementById('quizSubmitBtn');
    const quizFeedback = document.getElementById('quizFeedback');
    const quizHint = document.getElementById('quizHint');
    const quizProgress = document.getElementById('quizProgress');
    const quizNextBtn = document.getElementById('quizNextBtn');
    const exitQuizBtn = document.getElementById('exitQuizBtn');

    // ------------------ Flashcard rendering (unchanged) ------------------

    function csvToObjects(csv) {
      const data = Papa.parse(csv, { header: true, skipEmptyLines: true }).data;
      return data.map(item => ({
        ID: Number(item.ID),
        ImageURL: item.ImageURL,
        AuthorName: item.AuthorName,
        Works: parseWorksWithYears(item.Works)
      }));
    }
    function parseWorksWithYears(worksStr) {
      if (!worksStr) return [];
      const parts = worksStr.split(';').map(s => s.trim()).filter(Boolean);
      return parts.map(workStr => {
        const match = workStr.match(/(.*)\s+\((\d{1,4})\)$/);
        return match
          ? { title: match[1].trim(), year: Number(match[2]) }
          : { title: workStr, year: null }
      });
    }
    function renderCards(cardsData) {
      cardContainer.innerHTML = '';
      cardsData.forEach(data => {
        cardContainer.appendChild(renderCard(data));
      });
    }
    function renderCard(data) {
      const card = document.createElement('div');
      card.className = 'flip-card';
      card.onclick = () => {
        card.classList.toggle('flipped');
        card.classList.toggle('expanded');
      };
      card.dataset.id = data.ID;
      const worksListHTML = works => {
        const items = works.map(w => `<li>${w.year !== null ? w.title + ' (' + w.year + ')' : w.title}</li>`).join('');
        return `<ul class="works-list" tabindex="0">${items}</ul>`;
      };
      const frontContent = `<img src="${data.ImageURL}" alt="Image of ${data.AuthorName}" loading="lazy">`;
      const backContent = `<strong>${data.AuthorName}</strong>${worksListHTML(data.Works)}`;
      card.innerHTML = `
        <div class="flip-card-inner">
          <div class="flip-card-front">${frontContent}</div>
          <div class="flip-card-back">${backContent}</div>
        </div>`;
      return card;
    }

    // ------------------ Load and cache ------------------

    async function loadFullData() {
      try {
        const response = await fetch(CSV_URL);
        if (!response.ok) throw new Error(`Network response not ok ${response.status}`);
        const csvText = await response.text();
        allCardsData = csvToObjects(csvText);
        saveCardsToCache(allCardsData);
        renderCards(allCardsData);
        alert('Full data loaded! All cards updated.');
      } catch (err) {
        alert('Error loading full data: ' + err.message);
      }
    }
    function saveCardsToCache(cards) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
    }
    function loadCachedCards() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (!data) return [];
      try {
        return JSON.parse(data);
      } catch {
        return [];
      }
    }

    // ------------------ Reset cards ------------------

    function resetCards() {
      document.querySelectorAll('.flip-card').forEach(card => {
        card.classList.remove('flipped');
        card.classList.remove('expanded');
      });
      alert('All cards flipped to front.');
    }

    // ------------------ Quiz Mode Implementation ------------------

    function startQuiz() {
      if (!allCardsData.length) {
        alert('No card data loaded yet. Please reload data.');
        return;
      }
      quizActive = true;
      quizData = buildQuizData(allCardsData);
      if (!quizData.length) {
        alert('No works available in dataset for quiz.');
        return;
      }
      quizIndex = 0;
      quizAttempts = 0;
      fuse = new Fuse(quizData, {
        keys: ['author'],
        threshold: 0.3,
        ignoreLocation: true,
        minMatchCharLength: 2,
      });
      toggleModes(true);
      showQuizItem();
    }

    function exitQuiz() {
      quizActive = false;
      toggleModes(false);
    }

    function toggleModes(quizOn) {
      if (quizOn) {
        cardContainer.style.display = 'none';
        quizContainer.hidden = false;
        exitQuizBtn.style.display = 'inline-block';
      } else {
        cardContainer.style.display = '';
        quizContainer.hidden = true;
        exitQuizBtn.style.display = 'none';
        clearQuizUI();
      }
    }

    // Prepare quiz data as flat list of {work, author}
    function buildQuizData(cards) {
      const quizList = [];
      cards.forEach(card => {
        (card.Works || []).forEach(work => {
          if (work.title) {
            quizList.push({ work: work.title, author: card.AuthorName });
          }
        });
      });
      return quizList;
    }

    function showQuizItem() {
      quizFeedback.textContent = '';
      quizFeedback.className = 'quiz-feedback';
      quizHint.textContent = '';
      quizAnswerInput.value = '';
      quizAnswerInput.disabled = false;
      quizSubmitBtn.disabled = false;
      quizNextBtn.disabled = true;

      const current = quizData[quizIndex];
      quizWorkTitle.textContent = current.work;
      updateQuizProgress();
      quizAnswerInput.focus();
      quizAttempts = 0;
    }

    function checkQuizAnswer() {
      const userAnswer = quizAnswerInput.value.trim();
      if (!userAnswer) {
        quizFeedback.textContent = 'Please enter an answer.';
        quizFeedback.className = 'quiz-feedback wrong';
        return;
      }
      const correctAuthor = quizData[quizIndex].author;
      const results = fuse.search(userAnswer);
      const isCorrect = results.some(r => r.item.author === correctAuthor);

      if (isCorrect) {
        quizFeedback.textContent = 'Correct! 🎉';
        quizFeedback.className = 'quiz-feedback correct';
        quizAnswerInput.disabled = true;
        quizSubmitBtn.disabled = true;
        quizNextBtn.disabled = false;
        quizAttempts = 0;
      } else {
        quizAttempts++;
        quizFeedback.textContent = 'Incorrect.';
        quizFeedback.className = 'quiz-feedback wrong';
        if (quizAttempts <= maxHints) {
          quizHint.textContent = generateHint(correctAuthor, quizAttempts);
        }
        if (quizAttempts > maxHints) {
          quizHint.textContent = `The correct author is: ${correctAuthor}`;
          quizAnswerInput.disabled = true;
          quizSubmitBtn.disabled = true;
          quizNextBtn.disabled = false;
        }
      }
    }

    function generateHint(authorName, attemptNum) {
      if (attemptNum === 1) {
        const parts = authorName.split(' ');
        let initials = parts.map(p => p[0]).join('.');
        return `Hint: Author initials - ${initials}.`;
      } else if (attemptNum === 2) {
        const half = Math.floor(authorName.length / 2);
        return `Hint: Author's name starts with "${authorName.substring(0, half)}"`;
      } else {
        return 'Last attempt! Try your best.';
      }
    }

    function quizNext() {
      quizIndex++;
      if (quizIndex >= quizData.length) {
        alert('Quiz completed! Well done.');
        exitQuiz();
        return;
      }
      showQuizItem();
    }

    function updateQuizProgress() {
      quizProgress.textContent = `Work ${quizIndex + 1} of ${quizData.length}`;
    }

    function clearQuizUI() {
      quizWorkTitle.textContent = '';
      quizAnswerInput.value = '';
      quizFeedback.textContent = '';
      quizHint.textContent = '';
      quizProgress.textContent = '';
    }

    // ------------------ Event Listeners ------------------

    document.addEventListener('DOMContentLoaded', () => {
      const cachedCards = loadCachedCards();
      if (cachedCards.length) {
        allCardsData = cachedCards;
        renderCards(allCardsData);
      } else {
        loadFullData();
      }
    });

    document.getElementById('quizSubmitBtn').addEventListener('click', checkQuizAnswer);
    quizAnswerInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        checkQuizAnswer();
      }
    });
    quizNextBtn.addEventListener('click', quizNext);
    exitQuizBtn.addEventListener('click', exitQuiz);

    window.resetCards = resetCards;
    window.loadFullData = loadFullData;
    window.startQuiz = startQuiz;
    window.exitQuiz = exitQuiz;
  </script>
</body>
</html>
